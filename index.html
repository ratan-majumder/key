<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="utf-8" />
<title>Ratan Panel UI - Main</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body {
    margin: 0;
    background: linear-gradient(135deg, #0d0d0d, #1a1a1a);
    color: white;
    font-family: Arial, sans-serif;
    overflow-x: hidden;
}
#particles {
    position: fixed; width:100%; height:100%; z-index:-1;
    background-size: cover; background-image: url('https://i.ibb.co/2j6JfYF/particles.gif'); opacity:0.15;
}
.container { width:90%; max-width:500px; margin:auto; text-align:center; padding-top:40px; }
h2 { font-size:28px; margin-bottom:25px; text-shadow:0 0 15px #00eaff; }

/* Bangla animated glowing caption */
.gamer-caption {
    font-size:22px;
    font-weight:bold;
    margin-bottom:25px;
    text-shadow: 0 0 5px #ff00ff, 0 0 10px #ff00ff, 0 0 20px #00ffff, 0 0 30px #00ffff, 0 0 40px #ff00ff;
    animation: glowAnim 2.5s infinite alternate;
}
@keyframes glowAnim {
    0% { text-shadow: 0 0 5px #ff00ff, 0 0 10px #ff00ff, 0 0 20px #00ffff, 0 0 30px #00ffff, 0 0 40px #ff00ff; color:#ff00ff; }
    25% { text-shadow: 0 0 10px #ffdd00, 0 0 20px #ffdd00, 0 0 30px #00ffdd, 0 0 40px #00ffdd, 0 0 50px #ffdd00; color:#ffdd00; }
    50% { text-shadow: 0 0 10px #00ff00, 0 0 20px #00ff00, 0 0 30px #00ffff, 0 0 40px #00ffff, 0 0 50px #00ff00; color:#00ff00; }
    75% { text-shadow: 0 0 5px #ff00ff, 0 0 10px #ff00ff, 0 0 20px #ff00ff, 0 0 30px #00ffff, 0 0 40px #ff00ff; color:#ff00ff; }
    100% { text-shadow: 0 0 15px #ff0044, 0 0 25px #ff0044, 0 0 35px #44ffdd, 0 0 45px #44ffdd, 0 0 55px #ff0044; color:#ff0044; }
}

.btn {
    width:100%; padding:15px; margin-top:12px; border:none; border-radius:12px;
    font-size:18px; font-weight:bold; cursor:pointer;
    background:#111; color:#00eaff; box-shadow:0 0 10px #00eaff;
    position: relative; overflow: hidden; user-select:none;
    transition: background 0.3s ease, color 0.3s ease, box-shadow 0.3s ease, transform 0.3s ease;
}
.btn > .shine-text { position: relative; z-index:1; display:inline-block; transition: color 0.3s ease, text-shadow 0.3s ease; }
.btn::before {
    content:''; position:absolute; top:0; left:-75%; width:50%; height:100%;
    background: linear-gradient(120deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.6) 50%, rgba(255,255,255,0) 100%);
    transform: skewX(-20deg); pointer-events:none;
}
.btn:hover::before { left:125%; transition:left 0.7s ease; }
.btn:hover { background:#00eaff; color:#000; box-shadow:0 0 15px #00eaff,0 0 20px #00eaffaa; transform:scale(1.05);}
.btn:hover > .shine-text { color:#004d66; text-shadow:0 0 6px #00eaff,0 0 12px #00eaffaa; }

.footer { margin-top:30px; opacity:0.7; font-size:14px; }
.key-box { margin-top:20px; padding:15px; background:#0f0f0f; border-radius:10px; border:1px solid #00eaff; display:none; }
.key-text { font-size:20px; font-weight:bold; color:#00eaff; word-break:break-all; }
.copy-btn { margin-top:10px; padding:10px; background:#00eaff; color:black; border:none; border-radius:8px; font-weight:bold; cursor:pointer; }

.modal-back { position: fixed; inset:0; background: rgba(0,0,0,0.7); display:flex; align-items:center; justify-content:center; z-index:50; }
.modal { width:320px; background:#0b0b0b; padding:20px; border-radius:12px; box-shadow:0 0 20px #00eaff; }
.modal h3 { margin:0 0 10px 0; text-shadow:0 0 8px #00eaff; }
.modal input { width:100%; padding:10px; margin:8px 0; border-radius:8px; border:none; font-size:15px; }
.small { font-size:13px; opacity:0.8; margin-top:8px; }
.logout { margin-top:12px; padding:8px 12px; background:#ff4d4d; border:none; color:white; border-radius:8px; cursor:pointer; }
.info { margin-top:15px; font-size:15px; color:#00ffcc; text-align:left; background:#111; padding:10px; border-radius:10px; white-space: pre-line; }

.admin-link { color:#00eaff; font-weight:bold; text-decoration:underline; }
.admin-link:hover { color:#ffdd00; text-shadow:0 0 10px #ffdd00; }
</style>
</head>
<body>
<div id="particles"></div>
<div class="container">
<h2>ЁЯОо Ratan Panel тАУ Safe Gaming Zone ЁЯФе</h2>

<!-- Bangla animated caption -->
<div class="gamer-caption">ЁЯОп ржЧрзЗржорж╛рж░рж░рж╛ ржПржЦрж╛ржирзЗ ржоржЬрж╛ ржХрж░рзБржи, Key ржирж┐ржи, рж╕рзНржХрж┐рж▓ ржмрж╛ржбрж╝рж╛ржи! ЁЯФе</div>

<!-- Buttons -->
<button class="btn" onclick="window.open('https://discord.gg/q2G3k3HZXc')"><span class="shine-text">ЁЯТа Hex Server Discord</span></button>
<button class="btn" onclick="window.open('https://discord.com/channels/1257974538939928596/1386731448022728725')"><span class="shine-text">ЁЯТО Basic Panel</span></button>
<button class="btn" onclick="window.open('https://discord.com/channels/1257974538939928596/1386731448022728725')"><span class="shine-text">ЁЯЪА Extreme Panel</span></button>
<button class="btn" onclick="window.open('https://discord.com/channels/1257974538939928596/1386731448022728725')"><span class="shine-text">ЁЯФе Bypass Panel</span></button>
<button class="btn" onclick="window.open('https://discord.com/channels/1257974538939928596/1386731448022728725')"><span class="shine-text">ЁЯШО Emote Panel</span></button>
<button class="btn" onclick="window.open('https://www.youtube.com/@YOUTUBERJOY22/videos')"><span class="shine-text">тЦ╢я╕П YouTube</span></button>
<button class="btn" onclick="window.open('https://discord.gg/q2G3k3HZXc')"><span class="shine-text">ЁЯОз Support Server</span></button>
<button class="btn" onclick="window.open('https://discord.com/channels/1257974538939928596/1386731448022728725')"><span class="shine-text">ЁЯЫТ Buy Panel</span></button>

<button class="btn" id="getKeyBtn" onclick="getKey()"><span class="shine-text">ЁЯФС Key ржирж┐ржи</span></button>

<div id="keyBox" class="key-box">
    <div class="key-text" id="displayKey"></div>
    <button class="copy-btn" onclick="copyKey()">Copy ржХрж░рзБржи</button>
</div>

<p class="footer">┬й Ratan тАУ Safe Gaming Panel & Skill Boost</p>
<div id="userInfo" class="info" style="display:none"></div>
</div>

<div id="loginModal" class="modal-back" style="display:none">
    <div class="modal">
        <h3>ЁЯОо рж▓ржЧржЗржи ржХрж░рзБржи</h3>
        <input id="loginUser" placeholder="Username">
        <input id="loginPass" placeholder="Password" type="password">
        <button class="btn" style="width:100%; margin-top:6px;" onclick="doLogin()">рж▓ржЧржЗржи ржХрж░рзБржи</button>
        <div class="small">ржПржХрж╛ржЙржирзНржЯ ржирж╛ ржерж╛ржХрж▓рзЗ / key ржирж╛ ржерж╛ржХрж▓рзЗ admin ржПрж░ рж╕рж╛ржерзЗ ржпрзЛржЧрж╛ржпрзЛржЧ ржХрж░рзБржи: 
        <a href="https://www.facebook.com/profile.php?id=61552305287329" target="_blank" class="admin-link">FB Admin</a></div>
    </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, get, update, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyBOcA7LyCU-zNlVj13DQcZKD-ImdD7paOI",
  authDomain: "balh-1d419.firebaseapp.com",
  databaseURL: "https://balh-1d419-default-rtdb.firebaseio.com",
  projectId: "balh-1d419",
  storageBucket: "balh-1d419.firebasestorage.app",
  messagingSenderId: "1036597182312",
  appId: "1:1036597182312:web:749f9d6c30f200720f60dd",
  measurementId: "G-S2LZZ28SYN"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

let currentUserId = null;
let currentSession = null;
const loginModal = document.getElementById('loginModal');
const userInfoDiv = document.getElementById('userInfo');

function showLogin(){ loginModal.style.display="flex"; }
function hideLogin(){ loginModal.style.display="none"; }

// Location permission
let userLocation = {lat:'', lon:''};
async function requestLocation(){
    if(navigator.geolocation){
        navigator.geolocation.getCurrentPosition(pos=>{
            userLocation.lat = pos.coords.latitude;
            userLocation.lon = pos.coords.longitude;
        }, err=>{
            console.warn('Location permission denied');
        });
    }
}

window.addEventListener('load', async ()=>{
    await requestLocation();
    const session = localStorage.getItem('ratan_session');
    const uid = localStorage.getItem('ratan_userid');
    if(session && uid){
        const snap = await get(ref(db, 'users/' + uid));
        if(!snap.exists()){ logoutLocal(); showLogin(); return; }
        const user = snap.val();
        if(user.activeSession && user.activeSession === session){
            currentUserId = uid; currentSession = session;
            initAfterLogin(user);
            onValue(ref(db, 'users/' + uid + '/activeSession'), s=>{
                const val = s.val() || "";
                if(val !== currentSession){ alert('Session рж╢рзЗрж╖ рж╣ржпрж╝рзЗржЫрзЗред'); logoutLocal(); location.reload(); }
            });
            return;
        } else { logoutLocal(); showLogin(); return; }
    } else { showLogin(); }
});

function genSession(){ return Math.random().toString(36).substring(2)+Date.now().toString(36); }

window.doLogin = async function(){
    const username=document.getElementById('loginUser').value.trim();
    const password=document.getElementById('loginPass').value.trim();
    if(!username || !password) return alert('рж╕ржм рждржерзНржп ржкрзВрж░ржг ржХрж░рзБржиред');

    const snap=await get(ref(db,'users'));
    if(!snap.exists()) return alert('ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА ржкрж╛ржУржпрж╝рж╛ ржпрж╛ржпрж╝ржирж┐ред admin: https://www.facebook.com/profile.php?id=61552305287329');
    const data=snap.val();
    let foundId=null, foundUser=null;
    for(const id in data){ if(data[id].username===username && data[id].password===password){ foundId=id; foundUser=data[id]; break; } }
    if(!foundId) return alert('ржнрзБрж▓ ржирж╛ржо/ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржбред admin: https://www.facebook.com/profile.php?id=61552305287329');

    if(foundUser.expiry){
        const now=new Date(); const exp=new Date(foundUser.expiry);
        if(!isNaN(exp.getTime()) && now>exp) return alert('ржЖржкржирж╛рж░ ржПржХрж╛ржЙржирзНржЯрзЗрж░ ржорзЗржпрж╝рж╛ржж рж╢рзЗрж╖ рж╣ржпрж╝рзЗржЫрзЗред admin: https://www.facebook.com/profile.php?id=61552305287329');
    }

    const sessionId=genSession();
    await update(ref(db,'users/'+foundId),{ activeSession: sessionId });
    localStorage.setItem('ratan_session',sessionId);
    localStorage.setItem('ratan_userid',foundId);
    currentUserId=foundId; currentSession=sessionId;
    hideLogin();
    initAfterLogin(foundUser);
};

async function logoutLocal(){
    try{
        const uid=localStorage.getItem('ratan_userid');
        const sess=localStorage.getItem('ratan_session');
        if(uid && sess){
            const snap=await get(ref(db,'users/'+uid+'/activeSession'));
            if(snap.exists() && snap.val()===sess){ await update(ref(db,'users/'+uid),{ activeSession:"" }); }
        }
    }catch(e){}
    localStorage.removeItem('ratan_session'); localStorage.removeItem('ratan_userid');
    currentUserId=null; currentSession=null;
}

function initAfterLogin(user){
    document.getElementById('getKeyBtn').disabled=false;
    userInfoDiv.style.display='block';
    userInfoDiv.innerText=`рж▓ржЧржЗржи: ${user.username}\nржмрзНржпржмрзГрждрзНрждрж┐ Key: ${user.usedKeys || 0} / ${user.maxKeys || 0}\nENJOY OUR PANEL ЁЯШК SUBSCRIBE YT AND JOIN DC `;

    if(!document.getElementById('dynamicLogout')){
        const btn=document.createElement('button');
        btn.innerText='рж▓ржЧржЖржЙржЯ';
        btn.className='logout';
        btn.id='dynamicLogout';
        btn.onclick=async ()=>{ await logoutLocal(); location.reload(); };
        document.querySelector('.container').appendChild(btn);
    }
}

window.getKey = async function(){
    if(!currentUserId){ alert('ржкрзНрж░ржержорзЗ рж▓ржЧржЗржи ржХрж░рзБржи'); showLogin(); return; }

    const userSnap=await get(ref(db,'users/'+currentUserId));
    if(!userSnap.exists()){ alert('ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА ржкрж╛ржУржпрж╝рж╛ ржпрж╛ржпрж╝ржирж┐ред admin: https://www.facebook.com/profile.php?id=61552305287329'); logoutLocal(); showLogin(); return; }
    const user=userSnap.val();
    if(user.activeSession!==currentSession){ alert('Session ржЕржХрж╛рж░рзНржпржХрж░'); logoutLocal(); showLogin(); return; }

    const used=Number(user.usedKeys||0);
    const max=Number(user.maxKeys||0);
    if(max>0 && used>=max){ alert('ржЖржкржирж┐ ржЖржкржирж╛рж░ key рж╕рзАржорж╛ ржкрзВрж░рзНржг ржХрж░рзЗржЫрзЗржиред'); return; }

    const keysSnap=await get(ref(db,'keys'));
    if(!keysSnap.exists()) return alert('ржХрзЛржирзЛ key ржкрж╛ржУржпрж╝рж╛ ржпрж╛ржпрж╝ржирж┐ред');
    const keys=keysSnap.val();
    let selected=null, selectedId=null;
    for(const id in keys){ if(keys[id].used===0 || keys[id].used==="0"){ selected=keys[id]; selectedId=id; break; } }
    if(!selected) return alert('ржлрзНрж░рж┐ key ржирзЗржЗред');

    // IP fetch
    let userIP = 'unknown';
    try{ userIP = (await fetch('https://api64.ipify.org?format=json').then(r=>r.json())).ip; }catch(e){ console.warn(e); }

    // Send IP + Location to admin page (Firebase)
    await update(ref(db,'users/'+currentUserId+'/lastSessionInfo'),{
        ip: userIP,
        location: userLocation,
        time: new Date().toLocaleString()
    });

    await update(ref(db,'keys/'+selectedId),{ used:1, userName:user.username||'', time:new Date().toLocaleString(), ip:userIP, location:userLocation });
    await update(ref(db,'users/'+currentUserId),{ usedKeys:used+1 });

    document.getElementById('displayKey').innerText=selected.value;
    document.getElementById('keyBox').style.display='block';
    initAfterLogin(Object.assign(user,{usedKeys:used+1}));

    if(confirm('Key рждрзИрж░рж┐ рж╣ржпрж╝рзЗржЫрзЗ! WhatsApp ржП ржкрж╛ржарж╛ржмрзЗржи?')){
        const number=prompt('WhatsApp ржиржорзНржмрж░ (country code рж╕рж╣):','8801');
        if(number) window.open("https://wa.me/"+number+"?text="+encodeURIComponent("ржЖржкржирж╛рж░ Key: "+selected.value));
    }
};

window.copyKey=function(){
    const text=document.getElementById('displayKey').innerText;
    if(!text) return alert('Key ржирзЗржЗ'); navigator.clipboard.writeText(text).then(()=>alert('Copied!'));
};

document.getElementById('getKeyBtn').disabled=true;
</script>
</body>
</html>
